<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Svelte101 Workshop</title>
  <meta name="description" content="">
  <link href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMglEwCkbBSAcACBAAAeaR9cIAAAAASUVORK5CYII=" rel="icon" type="image/x-icon" />
  
    
    <link rel="stylesheet" href="https://unpkg.com/mvp.css">
    
    
  <meta property="og:title" content="Svelte101 Workshop">
  <meta property="og:image" content="">
  <meta property="og:image:alt" content="">
  <meta property="og:description" content="">
  
  
  <link rel="stylesheet"
        href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/styles/agate.min.css">
  <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/highlight.min.js"></script>     
  <script>hljs.initHighlightingOnLoad();</script>  
  
</head>

<body>
  <div id="wrapper">
  <main>

<h1 id="svelte101-workshop-notes">Svelte101 Workshop Notes</h1>
<h2 id="about-this-workshop">About this workshop</h2>
<p>This workshop is an immersive dive into the Svelte Framework, as a group, we will build a front-end application in Svelte and through the course of building this application, we will learn many of the features and benefits that Svelte has to offer. The notes will reference links to the svelte documentation if you want to dig deeper into any one feature. The purpose of this workshop is to give you a hands on feel of what it is like to work with the framework day in and day out. If you are up to the challenge please code along with the instructor, if the pace is too fast for you, don&#39;t worry, after the event the recorded version will be available for your to go at your own pace.</p>
<h2 id="about-me">About me</h2>
<p>Tom Wilson has been in the software development industry for over 25 years. Continuous learning and teaching have been a part of his journey. Since 2007, Tom has participated in the tech community hosting and running meetups and providing workshops focused on software development. In 2016, Tom launched a coding school in Charleston, SC, JRS Coding School, focused on full-stack javascript. In 2020, Tom founded hyper63; a company focused on leading engineers from beginner to expert.</p>
<h2 id="about-the-project">About the project</h2>
<p>In this workshop, we are going to build a weather application, this application, will show the current weather of a given location as well as list our favorite locations and and switch the current weather display from one of the favorite locations, then we will allow the user to add a new favorite city, to their favorites.</p>
<h2 id="housekeeping">Housekeeping</h2>
<p>In order to follow along with this workshop you will need an api key from <a href="https://weatherbit.io">https://weatherbit.io</a> it is free, it takes a little bit of time to provision, so you may want to do this soon.</p>
<h2 id="chat">Chat</h2>
<p><a href="https://discord.gg/fgjfwt">https://discord.gg/fgjfwt</a></p>
<p>Join channel #svelte101-workshop</p>
<h2 id="setup">Setup</h2>
<p>Pull workshop template down from github
and initialize it and provide link to clone.</p>
<p>Instructor...</p>
<pre><code class="language-sh">npx degit hyper63/weather weather-app
cd weather-app
git init
git add .
git commit -am &quot;first commit&quot;
gh repo create hyper63/s101-2020-9-25
git push origin master
yarn</code></pre>
<p>Students...</p>
<pre><code class="language-sh">git clone https://github.com/hyper63/s101-2020-9-25 weather-app
cd weather-app
yarn</code></pre>
<hr>
<p>Open in vscode</p>
<pre><code class="language-sh">code .</code></pre>
<h2 id="tour-repository">Tour Repository</h2>
<p>Check out quickstart guide:</p>
<p><a href="https://svelte.dev/blog/the-easiest-way-to-get-started">https://svelte.dev/blog/the-easiest-way-to-get-started</a></p>
<p>Quick tour of a common svelte project</p>
<ul>
<li>public - contains all public assets</li>
<li>src - contains your source code</li>
</ul>
<article><aside>

<pre><code class="language-sh">git checkout -b 1-template-basics</code></pre>
</aside></article>

<h2 id="svelte-basics">Svelte Basics</h2>
<p><a href="https://svelte.dev/docs">https://svelte.dev/docs</a></p>
<p>Lets turn this static html into a template:</p>
<p><code>src/views/Current.svelte</code></p>
<pre><code class="language-html">&lt;script&gt;
  const weather = {
    city: &quot;Charleston, SC&quot;,
    temp: &quot;72 &amp;deg; F&quot;,
    icon: &quot;a01n&quot;,
    description: &quot;clear&quot;,
  };
&lt;/script&gt;
&lt;nav&gt;
  &lt;div&gt;
    &lt;a href=&quot;&quot;&gt;F&lt;/a&gt;
    |
    &lt;a href=&quot;&quot;&gt;C&lt;/a&gt;
  &lt;/div&gt;
  &lt;a href=&quot;&quot;&gt;Favorites&lt;/a&gt;
&lt;/nav&gt;
&lt;main&gt;
  &lt;figure&gt;
    &lt;img alt=&quot;{weather.description}&quot; src=&quot;/icons/{weather.icon}.png&quot; /&gt;
  &lt;/figure&gt;
  &lt;h3&gt;{weather.city}&lt;/h3&gt;
  &lt;h1&gt;{@html weather.temp}&lt;/h1&gt;
  &lt;p&gt;{weather.description}&lt;/p&gt;
&lt;/main&gt;
&lt;style&gt;
  nav {
    margin-bottom: 0;
    margin-left: 8px;
    margin-right: 8px;
  }
  main {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
&lt;/style&gt;</code></pre>
<article><aside>

<p>Declare variables in the <code>&lt;script&gt;&lt;/script&gt;</code> block and reference them in your template using <code>{ }</code> curly braces. NOTE: you can place any JS expression in the curly braces and it will be evaluated.</p>
</aside></article>

<article><aside>

<p>You can also curly braces within properties, <code>src=&quot;/icons/{weather.icon}.png&quot;</code></p>
</aside></article>

<article><aside>

<p>Use the <code>{@html ...}</code> to convert a variable to html. <a href="https://svelte.dev/docs#html">https://svelte.dev/docs#html</a></p>
</aside></article>

<article><aside>

<p>Create checkpoint</p>
<pre><code class="language-sh">git commit -am &quot;1-template-basics&quot;
git push origin 1-template-basics
git checkout -b 2-creating-component</code></pre>
</aside></article>

<article><aside>

<p>Catch up to checkpoint</p>
<pre><code class="language-sh">git stash
git pull origin 1-template-basics</code></pre>
</aside></article>

<hr>
<h2 id="components---creating-a-component">Components - Creating a component</h2>
<p>Lets convert the main section of the Current.svelte component into a reusable weather component:</p>
<p><code>src/components/Weather.svelte</code></p>
<pre><code class="language-html">&lt;script&gt;
  // proptypes (we can validate props at runtime using proptypes module)
  export let icon, description, city, temp;
&lt;/script&gt;
&lt;figure&gt;
  &lt;img alt=&quot;{description}&quot; src=&quot;/icons/{icon}.png&quot; /&gt;
&lt;/figure&gt;
&lt;h3&gt;{city}&lt;/h3&gt;
&lt;h1&gt;{@html temp}&lt;/h1&gt;
&lt;p&gt;{description}&lt;/p&gt;</code></pre>
<p>Now our <code>src/views/Current.svelte</code> component looks like this</p>
<pre><code class="language-html">&lt;script&gt;
  import Weather from &quot;../components/Weather.svelte&quot;;
  const weather = {
    city: &quot;Charleston, SC&quot;,
    temp: &quot;72 &amp;deg; F&quot;,
    icon: &quot;a01n&quot;,
    description: &quot;clear&quot;,
  };
&lt;/script&gt;
&lt;nav&gt;
  &lt;div&gt;
    &lt;a href=&quot;&quot;&gt;F&lt;/a&gt;
    |
    &lt;a href=&quot;&quot;&gt;C&lt;/a&gt;
  &lt;/div&gt;
  &lt;a href=&quot;&quot;&gt;Favorites&lt;/a&gt;
&lt;/nav&gt;
&lt;main&gt;
  &lt;Weather {...weather} /&gt;
&lt;/main&gt;
&lt;style&gt;
  nav {
    margin-bottom: 0;
    margin-left: 8px;
    margin-right: 8px;
  }
  main {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
&lt;/style&gt;</code></pre>
<p>We can pass props by using <code>name={value}</code> or if the prop is the same name as the variable. <code>{value}</code> or we can use the spread operator: <code>{...value}</code> which will take an object and spread each key as a property.</p>
<article><aside>

<p>Create Checkpoint</p>
<pre><code class="language-sh">git commit -am &quot;2-creating-component&quot;
git push origin 2-creating-component
git checkout -b 3-reactivity</code></pre>
</aside></article>

<article><aside>

<p>Catch up to checkpoint</p>
<pre><code class="language-sh">git stash
git pull origin 2-creating-component</code></pre>
</aside></article>

<h2 id="reactivity---changing-display-of-temp">Reactivity - Changing display of temp</h2>
<p>In the top left corner of our app, we have a couple of links, on <code>F</code> and one <code>C</code> we want to capture the <code>click</code> event of these links and then based on the current temperature unit, we want to convert to the other temperature unit. We can use a module called <code>temperature</code> to help with the conversion. But we need to know the current value of the temperature and the current unit it is in. For example, now we have it listed as Fahrenheit.</p>
<p>In order to listen for a click event, we can use the <code>on</code> directive. The <code>on</code> directive takes an event that we want to listen to and we assign it to a function.</p>
<pre><code class="language-html">&lt;button on:click=&quot;{handleClick}&quot;&gt;...&lt;/button&gt;
&lt;script&gt;
  function handleClick() {
    console.log(&quot;click&quot;);
  }
&lt;/script&gt;</code></pre>
<p>Then in the function we want to change the temp value and unit based on the click function.</p>
<p>This is where reactivity comes into play. We can listen to the temp and unit variables and create a new derived variable called <code>displayTemp</code> this new variable will be the string we want to present.</p>
<pre><code class="language-html">&lt;script&gt;
  import { fahrenheitToCelsius, celsiusToFahrenheit } from &quot;temperature&quot;;

  import Weather from &quot;../components/Weather.svelte&quot;;

  let temp = 21.7;
  let unit = &quot;c&quot;;

  $: displayTemp = `${Math.floor(temp)} &amp;deg; ${unit.toUpperCase()}`;

  function convertToF() {
    temp = celsiusToFahrenheit(temp);
    unit = &quot;f&quot;;
  }

  function convertToC() {
    temp = fahrenheitToCelsius(temp);
    unit = &quot;c&quot;;
  }
&lt;/script&gt;
&lt;nav&gt;
  &lt;div&gt;
    &lt;a href=&quot;#&quot; on:click|preventDefault=&quot;{convertToF}&quot;&gt;F&lt;/a&gt;
    |
    &lt;a href=&quot;#&quot; on:click|preventDefault=&quot;{convertToC}&quot;&gt;C&lt;/a&gt;
  &lt;/div&gt;
  &lt;a href=&quot;&quot;&gt;Favorites&lt;/a&gt;
&lt;/nav&gt;
&lt;main&gt;{@html displayTemp} ...&lt;/main&gt;</code></pre>
<p>In this lesson, we learned about the <code>on</code> directive and how we can <code>|preventDefault</code> to directives. Also we learned about the <code>$:</code> reactivity command and how it can work like a formula in excel.</p>
<article><aside>

<p>Create checkpoint</p>
<pre><code class="language-sh">git commit -am &quot;3-reactivity&quot;
git push origin 3-reactivity
git checkout -b 4-async</code></pre>
</aside></article>

<article><aside>

<p>Catch up to checkpoint</p>
<pre><code class="language-sh">git stash
git pull origin 3-reactivity</code></pre>
</aside></article>

<hr>
<h2 id="async---calling-an-api">Async - Calling an API</h2>
<p>Now that we have moved our presentation to a component, lets add an api call to our Current view. We want to call the <code>/api/weather</code> endpoint using a <code>GET</code> method call. We need to give the request a querystring of <code>city=${city}&amp;country=${country}</code>.</p>
<article><aside>

<p>At this point, we will need the api key from weatherbit.io. We will want to add it to our <code>.env</code> file and restart our server.</p>
</aside></article>

<pre><code class="language-text">WEATHER_KEY=(Your key)</code></pre>
<p>Lets use the <code>async</code> library in our <code>lib</code> folder to call the weather api.</p>
<p><code>src/views/Current.svelte</code></p>
<pre><code class="language-html">&lt;script&gt;
  import { getJSON } from &quot;../lib/async.js&quot;;

  getJSON(&quot;/api/weather?city=charleston,sc&amp;country=us&quot;).then(
    console.log.bind(console)
  );
&lt;/script&gt;</code></pre>
<p>We should see the weather data come back from the api. We want to use this data to render our weather component.</p>
<p>Using the <code>onMount</code> function from svelte will let us handle async requests and apply the results to local variables.</p>
<pre><code class="language-html">&lt;script&gt;
  import { getJSON } from &quot;../lib/async.js&quot;;
  import Weather from &quot;../components/Weather.svelte&quot;;
  import { onMount } from &quot;svelte&quot;;

  let weather = {
    city: &quot;Charleston, SC&quot;,
    temp: &quot;72 &amp;deg; F&quot;,
    icon: &quot;a01n&quot;,
    description: &quot;clear&quot;,
  };

  onMount(async () =&gt; {
    const results = await getJSON(&quot;/api/weather?city=charleston,sc&amp;country=us&quot;);
    weather = {
      temp: `${results.temp} &amp;deg; C`,
      icon: results.weather.icon,
      description: results.weather.description,
      city: `${results.city_name} ${results.state_code}`,
    };
  });
&lt;/script&gt;
&lt;nav&gt;
  &lt;div&gt;
    &lt;a href=&quot;&quot;&gt;F&lt;/a&gt;
    |
    &lt;a href=&quot;&quot;&gt;C&lt;/a&gt;
  &lt;/div&gt;
  &lt;a href=&quot;&quot;&gt;Favorites&lt;/a&gt;
&lt;/nav&gt;
&lt;main&gt;
  &lt;Weather {...weather} /&gt;
&lt;/main&gt;
&lt;style&gt;
  nav {
    margin-bottom: 0;
    margin-left: 8px;
    margin-right: 8px;
  }
  main {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
&lt;/style&gt;</code></pre>
<p>Or we could create an async function and use the <code>{#await}</code> command.</p>
<pre><code class="language-html">&lt;script&gt;
  import { getJSON } from &quot;../lib/async.js&quot;;
  import Weather from &quot;../components/Weather.svelte&quot;;

  function getWeather() {
    return getJSON(&quot;/api/weather?city=charleston,sc&amp;country=us&quot;).then(
      (results) =&gt; ({
        temp: `${results.temp} &amp;deg; C`,
        icon: results.weather.icon,
        description: results.weather.description,
        city: `${results.city_name} ${results.state_code}`,
      })
    );
  }
&lt;/script&gt;
&lt;nav&gt;
  &lt;div&gt;
    &lt;a href=&quot;&quot;&gt;F&lt;/a&gt;
    |
    &lt;a href=&quot;&quot;&gt;C&lt;/a&gt;
  &lt;/div&gt;
  &lt;a href=&quot;&quot;&gt;Favorites&lt;/a&gt;
&lt;/nav&gt;
&lt;main&gt;
  {#await getWeather()} Loading... {:then weather}
  &lt;Weather {...weather} /&gt;
  {/await}
&lt;/main&gt;
&lt;style&gt;
  nav {
    margin-bottom: 0;
    margin-left: 8px;
    margin-right: 8px;
  }
  main {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
&lt;/style&gt;</code></pre>
<p>In this lesson, we learned about two ways to handle async requests from components at the point of loading.</p>
<article><aside>

<p>Create checkpoint</p>
<pre><code class="language-sh">git commit -am &quot;4-async&quot;
git push origin 4-async
git checkout -b 5-events</code></pre>
</aside></article>

<article><aside>

<p>Catch up to checkpoint</p>
<pre><code class="language-sh">git stash
git pull origin 4-async</code></pre>
</aside></article>

<hr>
<h2 id="each-and-dispatching-events">{#each} and Dispatching Events</h2>
<p>Lets start working on the <code>src/views/Favorites.svelte</code> view. This view lists the users favorite cities that they would like to get the weather from. Eventually, we will pull this list from the database, but for now, we will create a local variable.</p>
<article><aside>

<p>Change <code>App</code> to render the <code>Favorites</code> view</p>
</aside></article>

<p><code>src/views/Favorites.svelte</code></p>
<p>We need to handle the onclick event of each item, lets create a Card component then dispatch the click event from the card component.</p>
<p>From the click event, we need to route to the current view with the correct city parameters.</p>
<pre><code class="language-html">&lt;script&gt;
  import CityCard from &quot;../components/CityCard.svelte&quot;;

  let cities = [&quot;Charleston, SC&quot;, &quot;New york, NY&quot;, &quot;San Francisco, CA&quot;];

  function changeCurrentCity(city) {
    return () =&gt; {
      console.log(&quot;city&quot;, city);
    };
  }
&lt;/script&gt;
&lt;nav&gt;
  &lt;div&gt;Favorites&lt;/div&gt;
  &lt;a href=&quot;&quot;&gt;Add&lt;/a&gt;
&lt;/nav&gt;
&lt;main&gt;
  &lt;section&gt;
    {#each cities as city}
    &lt;CityCard {city} on:click=&quot;{changeCurrentCity(city)}&quot; /&gt;
    {/each}
  &lt;/section&gt;
&lt;/main&gt;
&lt;style&gt;
  nav {
    height: 24px;
    margin-bottom: 0;
    margin-left: 8px;
    margin-right: 8px;
  }
&lt;/style&gt;</code></pre>
<p><code>src/components/CityCard.svelte</code></p>
<pre><code class="language-html">&lt;script&gt;
  import { createEventDispatcher } from &quot;svelte&quot;;
  export let city;
  const dispatch = createEventDispatcher();

  function handleClick() {
    dispatch(&quot;click&quot;, { city });
  }
&lt;/script&gt;
&lt;aside on:click=&quot;{handleClick}&quot;&gt;
  &lt;h3&gt;{city}&lt;/h3&gt;
&lt;/aside&gt;
&lt;style&gt;
  aside:hover {
    background-color: whitesmoke;
  }
&lt;/style&gt;</code></pre>
<p>In this lesson, we created another component to handle each city card and used the <code>{#each}</code> template command to iterate over a list of cities and display the city card. Then we added a custom event to the city card which we handled in the Favorites component. Now we need to navigate from the favorites component to the Current component.</p>
<article><aside>

<p>Create checkpoint</p>
<pre><code class="language-sh">git commit -am &quot;5-events&quot;
git push origin 5-events
git checkout -b 6-routing</code></pre>
</aside></article>

<article><aside>

<p>Catch up to checkpoint</p>
<pre><code class="language-sh">git stash
git pull origin 5-events</code></pre>
</aside></article>

<hr>
<h3 id="take-break">Take Break</h3>
<hr>
<h3 id="review-questions">Review Questions</h3>
<hr>
<h2 id="routing">Routing</h2>
<p>For routing, we are going to use pagejs a framework agnostic routing component modeled after express.</p>
<p><a href="https://github.com/visionmedia/page.js">https://github.com/visionmedia/page.js</a></p>
<p><code>src/App.svelte</code></p>
<pre><code class="language-html">&lt;script&gt;
  import router from &quot;page&quot;;

  import Current from &quot;./views/Current.svelte&quot;;
  import Favorites from &quot;./views/Favorites.svelte&quot;;
  import Add from &quot;./views/Add.svelte&quot;;

  let page;

  router(&quot;/&quot;, navTo(Current));
  router(&quot;/favorites&quot;, navTo(Favorites));

  router.start();

  function navTo(Component) {
    return (ctx) =&gt; {
      page = Component;
    };
  }
&lt;/script&gt;
&lt;svelte:component this=&quot;{page}&quot; /&gt;</code></pre>
<p><code>src/views/Current.svelte</code></p>
<p>Add link to favorites</p>
<p><code>&lt;a href=&quot;/favorites&quot;&gt;Favorites&lt;/a&gt;</code></p>
<p>Use page to navigate to Current</p>
<pre><code class="language-html">&lt;script&gt;
  import CityCard from &quot;../components/CityCard.svelte&quot;;
  import page from &quot;page&quot;;

  let cities = [&quot;Charleston, SC&quot;, &quot;New york, NY&quot;, &quot;San Francisco, CA&quot;];

  function changeCurrentCity(city) {
    return () =&gt; {
      // set current city...then
      page(&quot;/&quot;);
    };
  }
&lt;/script&gt;
&lt;nav&gt;
  &lt;div&gt;Favorites&lt;/div&gt;
  &lt;a href=&quot;&quot;&gt;Add&lt;/a&gt;
&lt;/nav&gt;
&lt;main&gt;
  &lt;section&gt;
    {#each cities as city}
    &lt;CityCard {city} on:click=&quot;{changeCurrentCity(city)}&quot; /&gt;
    {/each}
  &lt;/section&gt;
&lt;/main&gt;
&lt;style&gt;
  nav {
    height: 24px;
    margin-bottom: 0;
    margin-left: 8px;
    margin-right: 8px;
  }
&lt;/style&gt;</code></pre>
<article><aside>

<p>Create checkpoint</p>
<pre><code class="language-sh">git commit -am &quot;6-routing&quot;
git push origin 6-routing
git checkout -b 7-stores</code></pre>
</aside></article>

<article><aside>

<p>Catch up to checkpoint</p>
<pre><code class="language-sh">git stash
git pull origin 6-routing</code></pre>
</aside></article>

<hr>
<h2 id="stores---sharing-data-between-components">Stores - Sharing data between components</h2>
<p>There are several ways to pass data one way is to use svelte stores.</p>
<p><a href="https://svelte.dev/docs#svelte_store">https://svelte.dev/docs#svelte_store</a></p>
<p><code>src/store.js</code></p>
<pre><code class="language-js">import { writable } from &quot;svelte/store&quot;;

export const store = writable({ current: &quot;Charleston, SC&quot; });

export const dispatch = (action) =&gt;
  new Promise((resolve) =&gt;
    store.update((state) =&gt; {
      resolve();
      if (action.type === &quot;SET_CURRENT&quot;) {
        return { ...state, current: action.payload };
      }
      return state;
    })
  );</code></pre>
<p><code>src/views/Favorites.svelte</code></p>
<pre><code class="language-html">&lt;script&gt;
  import { dispatch } from &quot;../store&quot;;
  import CityCard from &quot;../components/CityCard.svelte&quot;;
  import page from &quot;page&quot;;

  let cities = [&quot;Charleston, SC&quot;, &quot;New york, NY&quot;, &quot;San Francisco, CA&quot;];

  function changeCurrentCity(city) {
    return () =&gt; {
      // set current city...then
      dispatch({ type: &quot;SET_CURRENT&quot;, payload: city }).then(() =&gt; page(&quot;/&quot;));
    };
  }
&lt;/script&gt;
&lt;nav&gt;
  &lt;div&gt;Favorites&lt;/div&gt;
  &lt;a href=&quot;&quot;&gt;Add&lt;/a&gt;
&lt;/nav&gt;
&lt;main&gt;
  &lt;section&gt;
    {#each cities as city}
    &lt;CityCard {city} on:click=&quot;{changeCurrentCity(city)}&quot; /&gt;
    {/each}
  &lt;/section&gt;
&lt;/main&gt;
&lt;style&gt;
  nav {
    height: 24px;
    margin-bottom: 0;
    margin-left: 8px;
    margin-right: 8px;
  }
&lt;/style&gt;</code></pre>
<p><code>src/views/Current.svelte</code></p>
<pre><code class="language-html">&lt;script&gt;
  import { getJSON } from &quot;../lib/async.js&quot;;
  import { fahrenheitToCelsius, celsiusToFahrenheit } from &quot;temperature&quot;;
  import { store } from &quot;../store&quot;;

  import Weather from &quot;../components/Weather.svelte&quot;;

  let temp = 21.7;
  let unit = &quot;c&quot;;

  $: displayTemp = `${Math.floor(temp)} &amp;deg; ${unit.toUpperCase()}`;

  function getWeather() {
    const current = $store.current.toLowerCase().replace(&quot;, &quot;, &quot;,&quot;);
    return getJSON(`/api/weather?city=${current}&amp;country=us`).then(
      (results) =&gt; ({
        temp: `${results.temp} &amp;deg; C`,
        icon: results.weather.icon,
        description: results.weather.description,
        city: `${results.city_name} ${results.state_code}`,
      })
    );
  }

  function convertToF() {
    temp = celsiusToFahrenheit(temp);
    unit = &quot;f&quot;;
  }

  function convertToC() {
    temp = fahrenheitToCelsius(temp);
    unit = &quot;c&quot;;
  }
&lt;/script&gt;
&lt;nav&gt;
  &lt;div&gt;
    &lt;a href=&quot;#&quot; on:click=&quot;{convertToF}&quot;&gt;F&lt;/a&gt;
    |
    &lt;a href=&quot;#&quot; on:click=&quot;{convertToC}&quot;&gt;C&lt;/a&gt;
  &lt;/div&gt;
  &lt;a href=&quot;/favorites&quot;&gt;Favorites&lt;/a&gt;
&lt;/nav&gt;
&lt;main&gt;
  {@html displayTemp} {#await getWeather()} Loading... {:then weather}
  &lt;Weather {...weather} /&gt;
  {/await}
&lt;/main&gt;
&lt;style&gt;
  nav {
    margin-bottom: 0;
    margin-left: 8px;
    margin-right: 8px;
  }
  main {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
&lt;/style&gt;</code></pre>
<article><aside>

<p>Create checkpoint</p>
<pre><code class="language-sh">git commit -am &quot;7-stores&quot;
git push origin 7-stores
git checkout -b 8-transitions</code></pre>
</aside></article>

<article><aside>

<p>Catch up to checkpoint</p>
<pre><code class="language-sh">git stash
git pull origin 7-stores</code></pre>
</aside></article>

<hr>
<h2 id="transitions">Transitions</h2>
<p><a href="https://svelte.dev/docs#svelte_transition">https://svelte.dev/docs#svelte_transition</a></p>
<p><code>src/views/Current.svelte</code></p>
<pre><code class="language-html">&lt;script&gt;
  import { getJSON } from &quot;../lib/async.js&quot;;
  import { fahrenheitToCelsius, celsiusToFahrenheit } from &quot;temperature&quot;;
  import { store } from &quot;../store&quot;;
  import { fade, blur } from &quot;svelte/transition&quot;;

  import Weather from &quot;../components/Weather.svelte&quot;;

  let temp = 21.7;
  let unit = &quot;c&quot;;

  $: displayTemp = `${Math.floor(temp)} &amp;deg; ${unit.toUpperCase()}`;

  function getWeather() {
    const current = $store.current.toLowerCase().replace(&quot;, &quot;, &quot;,&quot;);
    return getJSON(`/api/weather?city=${current}&amp;country=us`).then(
      (results) =&gt; ({
        temp: `${results.temp} &amp;deg; C`,
        icon: results.weather.icon,
        description: results.weather.description,
        city: `${results.city_name} ${results.state_code}`,
      })
    );
  }

  function convertToF() {
    temp = celsiusToFahrenheit(temp);
    unit = &quot;f&quot;;
  }

  function convertToC() {
    temp = fahrenheitToCelsius(temp);
    unit = &quot;c&quot;;
  }
&lt;/script&gt;
&lt;nav&gt;
  &lt;div&gt;
    &lt;a href=&quot;#&quot; on:click=&quot;{convertToF}&quot;&gt;F&lt;/a&gt;
    |
    &lt;a href=&quot;#&quot; on:click=&quot;{convertToC}&quot;&gt;C&lt;/a&gt;
  &lt;/div&gt;
  &lt;a href=&quot;/favorites&quot;&gt;Favorites&lt;/a&gt;
&lt;/nav&gt;
&lt;main transition:fade=&quot;{{duration:&quot; 1000}}&gt;
  {@html displayTemp} {#await getWeather()} Loading... {:then weather}
  &lt;Weather {...weather} /&gt;
  {/await}
&lt;/main&gt;
&lt;style&gt;
  nav {
    margin-bottom: 0;
    margin-left: 8px;
    margin-right: 8px;
  }
  main {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
&lt;/style&gt;</code></pre>
<p><code>src/views/Favorites.svelte</code></p>
<pre><code class="language-html">&lt;script&gt;
  import { blur } from &#39;svelte/transition&#39;
  import { dispatch } from &#39;../store&#39;
  import CityCard from &#39;../components/CityCard.svelte&#39;
  import page from &#39;page&#39;

  let cities = [&#39;Charleston, SC&#39;, &#39;New york, NY&#39;, &#39;San Francisco, CA&#39;]

  function changeCurrentCity(city) {
    return () =&gt; {
      // set current city...then
      dispatch({type: &#39;SET_CURRENT&#39;, payload: city})
        .then(() =&gt; page(&#39;/&#39;))
    }
  }

&lt;/script&gt;
&lt;div in:blur={{delay: 1000, duration: 1000}}&gt;
&lt;nav&gt;
  &lt;div&gt;Favorites&lt;/div&gt;
  &lt;a href=&quot;&quot;&gt;Add&lt;/a&gt;
&lt;/nav&gt;
&lt;main&gt;
  &lt;section&gt;
    {#each cities as city}
      &lt;CityCard {city} on:click={changeCurrentCity(city)} /&gt;
    {/each}
  &lt;/section&gt;
&lt;/main&gt;
&lt;/div&gt;
&lt;style&gt;
 nav {
   height: 24px;
   margin-bottom: 0;
   margin-left: 8px;
   margin-right: 8px;
 }
&lt;/style&gt;</code></pre>
<article><aside>

<p>Create checkpoint</p>
<pre><code class="language-sh">git commit -am &quot;8-transitions&quot;
git push origin 8-transitions
git checkout -b 9-modal-actions</code></pre>
</aside></article>

<article><aside>

<p>Catch up to checkpoint</p>
<pre><code class="language-sh">git stash
git pull origin 8-transitions</code></pre>
</aside></article>

<hr>
<h3 id="take-break-1">Take Break</h3>
<hr>
<h3 id="review-questions-1">Review Questions</h3>
<hr>
<h2 id="modal-and-actions">Modal and Actions</h2>
<p>To handle adding a new city, lets use a modal component.</p>
<p><a href="https://svelte.dev/repl/e94473c00c5c422fa736ba60a2ca0e61?version=3.26.0">https://svelte.dev/repl/e94473c00c5c422fa736ba60a2ca0e61?version=3.26.0</a></p>
<p>Actions</p>
<p><a href="https://svelte.dev/docs#use_action">https://svelte.dev/docs#use_action</a></p>
<pre><code class="language-html">&lt;script&gt;
  import { createEventDispatcher } from &quot;svelte&quot;;
  import { scale } from &quot;svelte/transition&quot;;
  export let open = false;
  const dispatch = createEventDispatcher();

  function handleCloseClick() {
    dispatch(&quot;close&quot;);
  }

  // action

  function modalAction(node) {
    let fns = [];
    if (document.body.style.overflow !== &quot;hidden&quot;) {
      const original = document.body.style.overflow;
      document.body.style.overflow = &quot;hidden&quot;;
      fns = [...fns, () =&gt; (document.body.style.overflow = original)];
    }
    return {
      destroy: () =&gt; fns.map((fn) =&gt; fn()),
    };
  }
&lt;/script&gt;
{#if open}
&lt;div use:modalAction on:click=&quot;{handleCloseClick}&quot;&gt;
  &lt;section on:click|stopPropagation&gt;
    &lt;aside in:scale out:scale=&quot;{{duration:&quot; 500}}&gt;
      &lt;slot /&gt;
      &lt;br /&gt;
      &lt;button on:click|preventDefault=&quot;{handleCloseClick}&quot;&gt;Close&lt;/button&gt;
    &lt;/aside&gt;
  &lt;/section&gt;
&lt;/div&gt;
{/if}
&lt;style&gt;
  section {
    height: 100%;
    display: grid;
    place-items: center;
  }
  aside {
    background-color: white;
  }
  div {
    position: absolute;
    background-color: rgba(0, 0, 0, 0.8);
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
  }
&lt;/style&gt;</code></pre>
<p><code>src/views/Add.svelte</code></p>
<pre><code class="language-html">&lt;script&gt;
  import { createEventDispatcher } from &quot;svelte&quot;;
  const dispatch = createEventDispatcher();
  let city;

  function handleSubmit() {
    dispatch(&quot;add&quot;, { city });
    city = &quot;&quot;;
  }
&lt;/script&gt;
&lt;main&gt;
  &lt;section&gt;
    &lt;h3&gt;Add Location&lt;/h3&gt;
    &lt;form on:submit|preventDefault=&quot;{handleSubmit}&quot;&gt;
      &lt;div&gt;
        &lt;label for=&quot;city&quot;&gt;City&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;city&quot; bind:value=&quot;{city}&quot; /&gt;
      &lt;/div&gt;
      &lt;!--
      &lt;div&gt;
        &lt;label for=&quot;country&quot;&gt;Country&lt;/label&gt;
        &lt;select id=&quot;country&quot;&gt;
          &lt;option&gt;-- select --&lt;/option&gt;
        &lt;/select&gt;
      &lt;/div&gt;
      --&gt;
      &lt;div&gt;
        &lt;button id=&quot;add-btn&quot;&gt;Add&lt;/button&gt;
        &lt;a href=&quot;&quot;&gt;Cancel&lt;/a&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  &lt;/section&gt;
&lt;/main&gt;</code></pre>
<p><code>src/views/Favorites.svelte</code></p>
<pre><code class="language-html">&lt;script&gt;
  import { blur } from &#39;svelte/transition&#39;
  import { dispatch } from &#39;../store&#39;
  import CityCard from &#39;../components/CityCard.svelte&#39;
  import page from &#39;page&#39;
  import Modal from &#39;../components/Modal.svelte&#39;
  import Add from &#39;./Add.svelte&#39;

  let cities = [&#39;Charleston, SC&#39;, &#39;New york, NY&#39;, &#39;San Francisco, CA&#39;]
  let open = false

  function changeCurrentCity(city) {
    return () =&gt; {
      // set current city...then
      dispatch({type: &#39;SET_CURRENT&#39;, payload: city})
        .then(() =&gt; page(&#39;/&#39;))
    }
  }

  function openModal() {
    open = true
  }

  function addCity({detail}) {
    cities = [...cities, detail.city]
    open = false
  }

&lt;/script&gt;
&lt;div in:blur={{delay: 1000, duration: 1000}}&gt;
&lt;nav&gt;
  &lt;div&gt;Favorites&lt;/div&gt;
  &lt;a href=&quot;#&quot; on:click={openModal}&gt;Add&lt;/a&gt;
&lt;/nav&gt;
&lt;main&gt;
  &lt;section&gt;
    {#each cities as city}
      &lt;CityCard {city} on:click={changeCurrentCity(city)} /&gt;
    {/each}
  &lt;/section&gt;
&lt;/main&gt;
&lt;/div&gt;
&lt;Modal {open} on:close={_ =&gt; open = false}&gt;
  &lt;Add on:add={addCity} /&gt;
&lt;/Modal&gt;
&lt;style&gt;
 nav {
   height: 24px;
   margin-bottom: 0;
   margin-left: 8px;
   margin-right: 8px;
 }
&lt;/style&gt;</code></pre>
<article><aside>

<p>Create checkpoint</p>
<pre><code class="language-sh">git commit -am &quot;9-modal-actions&quot;
git push origin 9-modal-actions
git checkout -b 10-testing</code></pre>
</aside></article>

<article><aside>

<p>Catch up to checkpoint</p>
<pre><code class="language-sh">git stash
git pull origin 9-modal-actions</code></pre>
</aside></article>

<hr>
<h2 id="testing">Testing</h2>
<p>There are several options for unit testing, we will demo cypress-svelte-unit-test.</p>
<p><a href="https://github.com/bahmutov/cypress-svelte-unit-test">https://github.com/bahmutov/cypress-svelte-unit-test</a></p>
<p>Cypress is a front end testing tool for the modern web.</p>
<p><a href="https://www.cypress.io">https://www.cypress.io</a></p>
<h2 id="install-cypress">Install cypress</h2>
<p>The first thing we need to do is install cypress and cypress-svelte-unit-test:</p>
<pre><code class="language-sh">yarn add -D cypress cypress-svelte-unit-test</code></pre>
<h2 id="initialize-cypress">Initialize Cypress</h2>
<pre><code class="language-sh">yarn run cypress open</code></pre>
<p>Once you see the modal, you click <code>ok</code> and then close the cypress window.</p>
<article><aside>

<p>Cypress comes with a bunch of examples, but we don&#39;t need them for this walkthrough, you can get rid of them by running <code>rm -rf cypress/integration/examples</code></p>
</aside></article>

<h2 id="tell-cypress-to-use-rollup-when-working-with-svelte-components">Tell cypress to use rollup when working with svelte components</h2>
<p>Open an index.js file in the cypress/plugins directory and edit the following function:</p>
<pre><code class="language-js">module.exports = (on) =&gt; {
  const filePreprocessor = require(&quot;@bahmutov/cy-rollup&quot;);
  on(&quot;file:preprocessor&quot;, filePreprocessor());
};</code></pre>
<p>This code will give cypress the information it needs to compile the svelte component</p>
<h2 id="turn-on-component-support-for-cypress">Turn on component support for cypress</h2>
<p>When you installed cypress, the install created a cypress.json file, in this file we need to add the following entries:</p>
<pre><code class="language-json">{
  &quot;experimentalComponentTesting&quot;: true,
  &quot;componentFolder&quot;: &quot;src&quot;,
  &quot;testFiles&quot;: &quot;**/*spec.js&quot;
}</code></pre>
<p>The first entry is a flag to enable component testing, the second is the location of the components, finally the third entry is a pattern matcher for the test files.</p>
<h2 id="write-a-test">Write a test</h2>
<p>Now, we have our project configured we can write a test.</p>
<p>In our src folder, lets create a test for the App component.</p>
<p>create a new file src/views/Add.spec.js</p>
<pre><code class="language-js">import Add from &quot;./Add.svelte&quot;;
import { mount } from &quot;cypress-svelte-unit-test&quot;;

it(&quot;add city using form&quot;, () =&gt; {
  mount(Add, {
    callbacks: {
      add: cy.stub().as(&quot;add&quot;),
    },
  });
  cy.get(&quot;input#city&quot;).type(&quot;Boston, MA&quot;);
  cy.get(&quot;button#add-btn&quot;).click();
  cy.get(&quot;@add&quot;)
    .should(&quot;be.called&quot;)
    .its(&quot;firstCall.args.0.detail&quot;)
    .should(&quot;deep.equal&quot;, { city: &quot;Boston, MA&quot; });
});</code></pre>
<p><code>src/views/Add.svelte</code></p>
<pre><code class="language-html">&lt;script&gt;
  import { createEventDispatcher } from &quot;svelte&quot;;
  const dispatch = createEventDispatcher();

  let city = &quot;&quot;;

  function submitCity() {
    dispatch(&quot;add&quot;, { city });
    city = &quot;&quot;;
  }
&lt;/script&gt;
&lt;main&gt;
  &lt;section&gt;
    &lt;h3&gt;Add Location&lt;/h3&gt;
    &lt;form on:submit|preventDefault=&quot;{submitCity}&quot;&gt;
      &lt;div&gt;
        &lt;label for=&quot;city&quot;&gt;City&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;city&quot; bind:value=&quot;{city}&quot; /&gt;
      &lt;/div&gt;
      &lt;!--
      &lt;div&gt;
        &lt;label for=&quot;country&quot;&gt;Country&lt;/label&gt;
        &lt;select id=&quot;country&quot;&gt;
          &lt;option&gt;-- select --&lt;/option&gt;
        &lt;/select&gt;
      &lt;/div&gt;
      --&gt;
      &lt;div&gt;
        &lt;button id=&quot;add-btn&quot;&gt;Add&lt;/button&gt;
        &lt;a href=&quot;&quot;&gt;Cancel&lt;/a&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  &lt;/section&gt;
&lt;/main&gt;</code></pre>
<p>The it function takes a description and a callback function, in the callback function,
we use the imported mount function to mount the App component passing the name
prop</p>
<h2 id="run-the-test">Run the Test</h2>
<p>Now that we have our test, lets run it and see if it passes.</p>
<pre><code>yarn run cypress run</code></pre><p>This command will run cypress in the console.</p>
<p>If everything went as planned you should see a print out showing App.spec.js passed and all specs passed!</p>
<p><a href="https://docs.cypress.io/guides/overview/why-cypress.html#In-a-nutshell">https://docs.cypress.io/guides/overview/why-cypress.html#In-a-nutshell</a></p>
<p>Summary</p>
<p>In this lesson, we learned how to install cypress into a svelte project and enable it for unit testing. We also walked through a unit test example where we enter some text into a form and click the submit button and listen for the callback event to validate that the component is working with the happy path.</p>
<article><aside>

<p>Create checkpoint</p>
<pre><code class="language-sh">git add .
git commit -am &quot;10-testing&quot;
git push origin 10-testing</code></pre>
<article><aside>

<p>Catch up to checkpoint</p>
<pre><code class="language-sh">git stash
git pull origin 10-testing</code></pre>
</aside></article>

<hr>
<h2 id="review-questions-2">Review Questions</h2>
<hr>
<h2 id="closing">Closing</h2>
<p>Thank you!</p>
<ul>
<li>Thank you Rich Harris for creating Svelte!</li>
<li>Thank you Gleb Bahmutov for creating cypress-svelte-unit-test library</li>
<li>Thank you Svelte Community!</li>
<li>Thank you commuity for the opportunity to share!</li>
</ul>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://svelte.dev">https://svelte.dev</a></li>
<li><a href="https://sveltesociety.dev/">https://sveltesociety.dev/</a></li>
<li><a href="https://github.com/bahmutov/cypress-svelte-unit-test">https://github.com/bahmutov/cypress-svelte-unit-test</a></li>
<li><a href="https://svelte.dev/chat">https://svelte.dev/chat</a></li>
</ul>
<p>Will Svelte Scale?</p>
<ul>
<li><a href="https://github.com/halfnelson/svelte-it-will-scale">https://github.com/halfnelson/svelte-it-will-scale</a></li>
<li><a href="https://svelte-scaling.acmion.com/">https://svelte-scaling.acmion.com/</a></li>
</ul>
<h2 id="feedback-form">Feedback Form</h2>
<p>Thank you for taking the workshop, please take a few minutes and complete the feedback form so we can continue to improve on this experience.</p>
<p><a href="https://forms.gle/5hV7or82nd8qGFAd8">https://forms.gle/5hV7or82nd8qGFAd8</a></p>
<h2 id="svelte-summit">Svelte Summit</h2>
<p>October 18, 2020</p>
<p><a href="https://sveltesummit.com/">https://sveltesummit.com/</a></p>
<h2 id="hyper63s-next-workshop">hyper63&#39;s next Workshop</h2>
<p>Sapper, Tailwind, and Svelte</p>
<p>October 29 and 30 from 2pm - 5pm EST</p>
<p>This is a 6 hour immersive workshop split into two three hour sessions for two days. The workshop will cover server-side rendering, code-splitting, client/server semantics, dynamic imports, tailwind basics, setting up tailwind with sapper, postcss, and more. By the end of this workshop you will be prepared to create scalable and performant web applications with joy.</p>
<p>Register here:</p>
</main>

  </div> 
</body>

</html>
